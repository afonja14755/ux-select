var g=Object.defineProperty;var x=(r,d,h)=>d in r?g(r,d,{enumerable:!0,configurable:!0,writable:!0,value:h}):r[d]=h;var c=(r,d,h)=>x(r,typeof d!="symbol"?d+"":d,h);this.UxSelect=function(){"use strict";function r(p){const s=new Event("change");p.dispatchEvent(s)}function d(p){const s=new Event("input");p.dispatchEvent(s)}class h{constructor(s,e={}){c(this,"el");c(this,"config");c(this,"localization");c(this,"state");c(this,"options");c(this,"groups");c(this,"uxEl");c(this,"uxBody");c(this,"uxSearchInput");c(this,"uxClearButton");c(this,"uxSelectAll");this.el=s,this.config={isSearchable:this.el.dataset.isSearchable!==void 0?this.el.dataset.isSearchable==="true":e.isSearchable??!1,isSearchFocus:this.el.dataset.isSearchFocus!==void 0?this.el.dataset.isSearchFocus==="true":e.isSearchFocus??!1,searchName:this.el.dataset.searchName!==void 0?this.el.dataset.searchName:e.searchName??"",isDisplaySelectedItems:this.el.dataset.isDisplaySelectedItems!==void 0?this.el.dataset.isDisplaySelectedItems==="true":e.isDisplaySelectedItems??!1,isGroupOptions:this.el.dataset.isGroupOptions!==void 0?this.el.dataset.isGroupOptions==="true":e.isGroupOptions??!1,hideOnClear:this.el.dataset.hideOnClear!==void 0?this.el.dataset.hideOnClear==="true":e.hideOnClear??!0,hideOnSelect:this.el.dataset.hideOnSelect!==void 0?this.el.dataset.hideOnSelect==="true":e.hideOnSelect??!1,optionStyle:this.el.dataset.optionStyle??e.optionStyle??"default",closeButton:this.el.dataset.closeButton!==void 0?this.el.dataset.closeButton==="true":e.closeButton??!0,selectAllOption:this.el.dataset.selectAllOption!==void 0?this.el.dataset.selectAllOption==="true":e.selectAllOption??!1},this.localization={placeholder:this.el.dataset.placeholder??e.placeholder??"Select an option",searchText:this.el.dataset.searchText??e.searchText??"Search",clearText:this.el.dataset.clearText??e.clearText??"Clear option(s)",selectedText:this.el.dataset.selectedText??e.selectedText??"Selected:",selectAllText:this.el.dataset.selectAllText??e.selectAllText??"Select all"},this.state={multiple:this.el.multiple,disabled:this.el.disabled,isAllSelected:!1},this.options=this.extractOptions(),this.groups=this.extractGroups(),this.uxEl=this.create(),this.setSelectState(),this.bindEvents()}extractOptions(s=!1){const e=this.el.options,i=this.config.isGroupOptions,o=[];for(const t of e){if(t.value==="")continue;let l="empty";i&&t.dataset.uxSelectGroup&&(l=t.dataset.uxSelectGroup);let a;s&&(a=this.uxEl.querySelector(`.ux-select-group__elem[data-value='${t.value}']`));let n,u;this.config.optionStyle==="image"&&t.dataset.imageSrc?n={src:t.dataset.imageSrc,srcset:t.dataset.imageSrcset??void 0,alt:t.dataset.imageAlt??"",width:t.dataset.imageWidth?Number(t.dataset.imageWidth):24,height:t.dataset.imageHeight?Number(t.dataset.imageHeight):24}:this.config.optionStyle==="image"&&t.dataset.svgSrc&&(u={src:t.dataset.svgSrc,width:t.dataset.svgWidth?Number(t.dataset.svgWidth):24,height:t.dataset.svgHeight?Number(t.dataset.svgHeight):24}),o.push({attributes:{selected:t.selected,disabled:t.disabled,group:l},data:{text:t.textContent?t.textContent.trim():"",value:t.value},image:n,svg:u,element:t,uxOption:a})}return o}extractGroups(){const s=this.el.options,e=this.config.isGroupOptions,i=new Set;for(const o of s){if(o.value==="")continue;let t="empty";e&&o.dataset.uxSelectGroup&&(t=o.dataset.uxSelectGroup),i.add(t)}return Array.from(i)}setSelectState(){const s=this.uxEl.querySelector(".ux-select__title"),e=this.options.reduce((i,o)=>(o.attributes.selected&&i.push(o.data.text),i),[]);if(e.length>0?(e.length===1?s.textContent=e[0]:this.state.multiple&&(s.textContent=this.config.isDisplaySelectedItems?e.join(", "):`${this.localization.selectedText} ${e.length}`),this.uxEl.classList.add("-filled")):(s.textContent=this.localization.placeholder,this.uxEl.classList.remove("-filled")),this.config.isGroupOptions)for(const i of this.groups){const o=this.uxEl.querySelector(`[data-ux-group="${i}"]`);if(!o)continue;const t=o.querySelector(".ux-select-group__list");if(!t)continue;const a=Array.from(t.querySelectorAll(".ux-select-group__elem")).every(n=>{n.classList.contains("-disabled")});o.classList.toggle("-disabled",a)}if(this.uxSelectAll){this.uxSelectAll.querySelector(".ux-select-select-all__checkbox")?.classList.remove("-null","-all","-some");const i=this.options.every(l=>l.attributes.selected),o=this.options.some(l=>l.attributes.selected);this.state.isAllSelected=i;let t="-null";i?t="-all":o&&(t="-some"),this.uxSelectAll.querySelector(".ux-select-select-all__checkbox")?.classList.add(t)}}createGroupElement(s){const e=document.createElement("div");if(e.classList.add("ux-select__group","ux-select-group"),e.dataset.uxGroup=s,s==="empty")e.classList.add("-empty");else{const o=document.createElement("div");o.classList.add("ux-select-group__title"),o.textContent=s,e.appendChild(o)}const i=document.createElement("ul");return i.classList.add("ux-select-group__list"),e.appendChild(i),e}createGroupAndOptions(){const s=document.createElement("div");if(s.classList.add("ux-select__dropdown"),this.state.multiple&&this.config.selectAllOption){const t=document.createElement("div");t.classList.add("ux-select__select-all");const l=document.createElement("div");l.classList.add("ux-select-select-all__checkbox");const a=document.createElement("div");a.classList.add("ux-select-select-all__text"),a.textContent=this.localization.selectAllText,t.append(l,a),this.uxSelectAll=t,this.uxSelectAll.addEventListener("click",this.onClickSelectAll.bind(this)),s.appendChild(t)}const e=document.createDocumentFragment(),i={};for(const t of this.groups){const l=this.createGroupElement(t);e.appendChild(l),i[t]=document.createDocumentFragment()}s.appendChild(e);for(const t of this.options){const l=document.createElement("li");if(l.classList.add("ux-select-group__elem"),l.dataset.value=t.data.value,l.textContent=t.data.text,t.attributes.selected&&l.classList.add("-selected"),t.attributes.disabled&&l.classList.add("-disabled"),this.config.optionStyle==="image"&&t.image){const a=document.createElement("img");a.classList.add("ux-select-group-elem__image"),a.src=t.image.src,a.width=t.image.width,a.height=t.image.height,a.alt=t.image.alt,t.image.srcset&&(a.srcset=`${t.image.src} 1x, ${t.image.srcset} 2x`),l.appendChild(a)}if(this.config.optionStyle==="image"&&t.svg){const a=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=document.createElementNS("http://www.w3.org/2000/svg","use");a.classList.add("ux-select-group-elem__image"),a.setAttribute("viewBox",`0 0 ${String(t.svg.width)} ${String(t.svg.height)}`),a.setAttribute("width",String(t.svg.width)),a.setAttribute("height",String(t.svg.height)),n.setAttribute("href",t.svg.src),a.appendChild(n),l.appendChild(a)}l.addEventListener("click",this.onClickOption.bind(this)),i[t.attributes.group].appendChild(l),t.uxOption=l}for(const t of this.groups){const l=i[t],a=s.querySelector(`[data-ux-group="${t}"] .ux-select-group__list`);a&&a.appendChild(l)}if(!this.uxBody)throw new Error("uxBody is undefined");const o=this.config.isSearchable?1:0;this.uxBody.childNodes[o]?this.uxBody.replaceChild(s,this.uxBody.childNodes[o]):this.uxBody.appendChild(s)}create(){const s=document.createElement("div");s.classList.add("ux-select__head");const e=document.createElement("div");if(e.classList.add("ux-select__title"),e.textContent=this.localization.placeholder,s.appendChild(e),this.config.closeButton){const l=document.createElement("button");l.type="button",l.classList.add("ux-select__clear"),l.title=this.localization.clearText,this.uxClearButton=l,s.appendChild(l)}const i=document.createElement("div");if(i.classList.add("ux-select__body"),this.uxBody=i,this.config.isSearchable){const l=document.createElement("div");l.classList.add("ux-select__search");const a=document.createElement("input");a.type="search",this.config.searchName&&(a.name=this.config.searchName),a.classList.add("ux-select-search__input"),a.placeholder=this.localization.searchText,this.uxSearchInput=a,l.appendChild(a),i.appendChild(l)}this.createGroupAndOptions();const o=document.createElement("div"),t=["ux-select",this.el.classList];return this.state.multiple&&t.push("-multiple"),this.state.disabled&&t.push("-disabled"),this.config.optionStyle!=="default"&&t.push(`-${this.config.optionStyle}`),o.className=t.join(" "),o.append(s,i),this.el.style.display="none",this.el.insertAdjacentElement("afterend",o),this.el.nextElementSibling}enable(){this.state.disabled&&(this.el.disabled=!1,this.uxEl.classList.remove("-disabled"),this.state.disabled=!1)}disable(){this.state.disabled||(this.el.disabled=!0,this.uxEl.classList.add("-disabled"),this.state.disabled=!0)}update(s=!0){const e=JSON.stringify(this.options);this.options=this.extractOptions(!0),this.groups=this.extractGroups(),e!==JSON.stringify(this.options)&&this.createGroupAndOptions(),this.setSelectState(),this.el.disabled?this.disable():this.enable(),s&&r(this.el)}clear(){for(const s of this.options)s.attributes.selected&&(s.attributes.selected=!1,s.element.selected=!1,s.uxOption&&s.uxOption.classList.remove("-selected"));this.setSelectState(),r(this.el)}destroy(){this.uxEl.remove(),this.el.style.display=""}onToggleShown(s){s.preventDefault();const e=s.target;if(!this.state.disabled&&!(this.uxClearButton&&s.target===this.uxClearButton)&&!(this.uxBody&&this.uxBody.contains(e))){if(this.uxEl.classList.contains("-shown")){this.uxEl.classList.remove("-shown");return}this.uxEl.classList.add("-shown"),this.config.isSearchable&&this.uxSearchInput&&(this.uxSearchInput.value="",this.uxSearchInput.dispatchEvent(new Event("input")),this.config.isSearchFocus&&this.uxSearchInput.focus())}}onClickOutside(s){const e=s.target;this.uxEl.contains(e)||this.uxEl.classList.remove("-shown")}onClickClear(s){if(s.preventDefault(),!this.state.disabled)return this.config.hideOnClear&&this.uxEl.classList.remove("-shown"),this.clear()}onClickSelectAll(s){s.preventDefault();const e=this.options.every(i=>i.attributes.selected);for(const i of this.options)i.attributes.disabled||(i.attributes.selected=!e,i.element.selected=!e,i.uxOption?.classList.toggle("-selected",!e));return this.config.hideOnSelect&&this.uxEl.classList.remove("-shown"),this.update()}onClickOption(s){s.preventDefault();const e=s.target;if(!e.classList.contains("-disabled")&&!(!this.state.multiple&&e.classList.contains("-selected"))){if(this.state.multiple){s.stopPropagation();const i=this.options.find(o=>o.uxOption===e);i&&i.uxOption&&(i.attributes.selected=!i.attributes.selected,i.element.selected=i.attributes.selected,i.uxOption.classList.toggle("-selected"))}else for(const i of this.options){const o=i.uxOption===e;i.attributes.selected=o,i.element.selected=o,i.uxOption&&i.uxOption.classList.toggle("-selected",o)}return this.config.hideOnSelect&&this.uxEl.classList.remove("-shown"),this.update()}}onSearch(s){if(s.target===null)return;const e=n=>n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),i=s.target,o=e(i.value),t=o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),l=this.uxEl.querySelectorAll(".ux-select-group");if(o===""){for(const n of this.options)n.uxOption&&(n.uxOption.style.display="");if(this.config.isGroupOptions)for(const n of l)n.style.display="";return}const a=new RegExp(t);for(const n of this.options){const u=a.test(e(n.data.text));n.uxOption&&(n.uxOption.style.display=u?"":"none")}if(this.config.isGroupOptions)for(const n of l){n.style.display="";const u=n.querySelector(".ux-select-group__list");u&&(n.style.display=u.clientHeight!==0?"":"none")}d(this.el)}bindEvents(){this.uxEl.addEventListener("click",this.onToggleShown.bind(this)),this.uxClearButton&&this.uxClearButton.addEventListener("click",this.onClickClear.bind(this)),window.addEventListener("click",this.onClickOutside.bind(this)),this.config.isSearchable&&this.uxSearchInput&&this.uxSearchInput.addEventListener("input",this.onSearch.bind(this))}}return h}();
//# sourceMappingURL=ux-select.iife.js.map
