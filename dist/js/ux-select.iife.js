var f=Object.defineProperty;var x=(d,c,u)=>c in d?f(d,c,{enumerable:!0,configurable:!0,writable:!0,value:u}):d[c]=u;var a=(d,c,u)=>(x(d,typeof c!="symbol"?c+"":c,u),u);this["ux-select"]=function(){"use strict";const d="";function c(h){const e=new Event("change");h.dispatchEvent(e)}function u(h){const e=new Event("input");h.dispatchEvent(e)}class p{constructor(e,s={}){a(this,"el");a(this,"config");a(this,"localization");a(this,"state");a(this,"options");a(this,"groups");a(this,"uxEl");a(this,"uxBody");a(this,"uxSearchInput");a(this,"uxClearButton");this.el=e,this.config={isSearchable:this.el.dataset.isSearchable!==void 0?this.el.dataset.isSearchable==="true":s.isSearchable??!1,isSearchFocus:this.el.dataset.isSearchFocus!==void 0?this.el.dataset.isSearchFocus==="true":s.isSearchFocus??!1,isGroupOptions:this.el.dataset.isGroupOptions!==void 0?this.el.dataset.isGroupOptions==="true":s.isGroupOptions??!1,hideOnClear:this.el.dataset.hideOnClear!==void 0?this.el.dataset.hideOnClear==="true":s.hideOnClear??!0,hideOnSelect:this.el.dataset.hideOnSelect!==void 0?this.el.dataset.hideOnSelect==="true":s.hideOnSelect??!1,optionStyle:this.el.dataset.optionStyle??s.optionStyle??"default",closeButton:this.el.dataset.closeButton!==void 0?this.el.dataset.closeButton==="true":s.closeButton??!0},this.localization={placeholder:this.el.dataset.placeholder??s.placeholder??"Select an option",searchText:this.el.dataset.searchText??s.searchText??"Search",clearText:this.el.dataset.clearText??s.clearText??"Clear option(s)",selectedText:this.el.dataset.selectedText??s.selectedText??"Selected:"},this.state={multiple:this.el.multiple,disabled:this.el.disabled},this.options=this.extractOptions(),this.groups=this.extractGroups(),this.uxEl=this.create(),this.setSelectState(),this.bindEvents()}extractOptions(e=!1){const s=this.el.options,i=this.config.isGroupOptions,l=[];for(const t of s){if(t.value==="")continue;let n="empty";i&&t.dataset.uxSelectGroup&&(n=t.dataset.uxSelectGroup);let o;e&&(o=this.uxEl.querySelector(`.ux-select-group__elem[data-value='${t.value}']`));let r;this.config.optionStyle==="image"&&t.dataset.imageSrc&&(r={src:t.dataset.imageSrc,srcset:t.dataset.imageSrcset??void 0,alt:t.dataset.imageAlt??"",width:t.dataset.imageWidth?Number(t.dataset.imageWidth):24,height:t.dataset.imageHeight?Number(t.dataset.imageHeight):24}),l.push({attributes:{selected:t.selected,disabled:t.disabled,group:n},data:{text:t.textContent?t.textContent.trim():"",value:t.value},image:r,element:t,uxOption:o})}return l}extractGroups(){const e=this.el.options,s=this.config.isGroupOptions,i=new Set;for(const l of e){if(l.value==="")continue;let t="empty";s&&l.dataset.uxSelectGroup&&(t=l.dataset.uxSelectGroup),i.add(t)}return Array.from(i)}setSelectState(){const e=this.uxEl.querySelector(".ux-select__title"),s=this.options.reduce((i,l)=>(l.attributes.selected&&i.push(l.data.text),i),[]);if(s.length>0?(s.length===1?e.textContent=s[0]:this.state.multiple&&(e.textContent=`${this.localization.selectedText} ${s.length}`),this.uxEl.classList.add("-filled")):(e.textContent=this.localization.placeholder,this.uxEl.classList.remove("-filled")),this.config.isGroupOptions)for(const i of this.groups){const l=this.uxEl.querySelector(`[data-ux-group="${i}"]`);if(!l)continue;const t=l.querySelector(".ux-select-group__list");if(!t)continue;const o=Array.from(t.querySelectorAll(".ux-select-group__elem")).every(r=>{r.classList.contains("-disabled")});l.classList.toggle("-disabled",o)}}createGroupElement(e){const s=document.createElement("div");if(s.classList.add("ux-select__group","ux-select-group"),s.dataset.uxGroup=e,e==="empty")s.classList.add("-empty");else{const l=document.createElement("div");l.classList.add("ux-select-group__title"),l.textContent=e,s.appendChild(l)}const i=document.createElement("ul");return i.classList.add("ux-select-group__list"),s.appendChild(i),s}createGroupAndOptions(){const e=document.createElement("div");e.classList.add("ux-select__dropdown");const s=document.createDocumentFragment(),i={};for(const t of this.groups){const n=this.createGroupElement(t);s.appendChild(n),i[t]=document.createDocumentFragment()}e.appendChild(s);for(const t of this.options){const n=document.createElement("li");if(n.classList.add("ux-select-group__elem"),n.dataset.value=t.data.value,n.textContent=t.data.text,t.attributes.selected&&n.classList.add("-selected"),t.attributes.disabled&&n.classList.add("-disabled"),this.config.optionStyle==="image"&&t.image){const o=document.createElement("img");o.classList.add("ux-select-group-elem__image"),o.src=t.image.src,o.width=t.image.width,o.height=t.image.height,o.alt=t.image.alt,t.image.srcset&&(o.srcset=`${t.image.src} 1x, ${t.image.srcset} 2x`),n.appendChild(o)}n.addEventListener("click",this.onClickOption.bind(this)),i[t.attributes.group].appendChild(n),t.uxOption=n}for(const t of this.groups){const n=i[t],o=e.querySelector(`[data-ux-group="${t}"] .ux-select-group__list`);o&&o.appendChild(n)}if(!this.uxBody)throw new Error("uxBody is undefined");const l=this.config.isSearchable?1:0;this.uxBody.childNodes[l]?this.uxBody.replaceChild(e,this.uxBody.childNodes[l]):this.uxBody.appendChild(e)}create(){const e=document.createElement("div");e.classList.add("ux-select__head");const s=document.createElement("div");if(s.classList.add("ux-select__title"),s.textContent=this.localization.placeholder,e.appendChild(s),this.config.closeButton){const n=document.createElement("button");n.type="button",n.classList.add("ux-select__clear"),n.title=this.localization.clearText,this.uxClearButton=n,e.appendChild(n)}const i=document.createElement("div");if(i.classList.add("ux-select__body"),this.uxBody=i,this.config.isSearchable){const n=document.createElement("div");n.classList.add("ux-select__search");const o=document.createElement("input");o.type="search",o.classList.add("ux-select-search__input"),o.placeholder=this.localization.searchText,this.uxSearchInput=o,n.appendChild(o),i.appendChild(n)}this.createGroupAndOptions();const l=document.createElement("div"),t=["ux-select",this.el.classList];return this.state.multiple&&t.push("-multiple"),this.state.disabled&&t.push("-disabled"),this.config.optionStyle!=="default"&&t.push(`-${this.config.optionStyle}`),l.className=t.join(" "),l.append(e,i),this.el.style.display="none",this.el.insertAdjacentElement("afterend",l),this.el.nextElementSibling}enable(){this.state.disabled&&(this.el.disabled=!1,this.uxEl.classList.remove("-disabled"),this.state.disabled=!1)}disable(){this.state.disabled||(this.el.disabled=!0,this.uxEl.classList.add("-disabled"),this.state.disabled=!0)}update(e=!0){const s=JSON.stringify(this.options);this.options=this.extractOptions(!0),this.groups=this.extractGroups(),s!==JSON.stringify(this.options)&&this.createGroupAndOptions(),this.setSelectState(),this.el.disabled?this.disable():this.enable(),e&&c(this.el)}clear(){for(const e of this.options)e.attributes.selected&&(e.attributes.selected=!1,e.element.selected=!1,e.uxOption&&e.uxOption.classList.remove("-selected"));this.setSelectState(),c(this.el)}destroy(){this.uxEl.remove(),this.el.style.display=""}onToggleShown(e){e.preventDefault();const s=e.target;if(!this.state.disabled&&!(this.uxClearButton&&e.target===this.uxClearButton)&&!(this.uxBody&&this.uxBody.contains(s))){if(this.uxEl.classList.contains("-shown")){this.uxEl.classList.remove("-shown");return}this.uxEl.classList.add("-shown"),this.config.isSearchable&&this.uxSearchInput&&(this.uxSearchInput.value="",this.uxSearchInput.dispatchEvent(new Event("input")),this.config.isSearchFocus&&this.uxSearchInput.focus())}}onClickOutside(e){const s=e.target;this.uxEl.contains(s)||this.uxEl.classList.remove("-shown")}onClickClear(e){if(e.preventDefault(),!this.state.disabled)return this.config.hideOnClear&&this.uxEl.classList.remove("-shown"),this.clear()}onClickOption(e){e.preventDefault();const s=e.target;if(!s.classList.contains("-disabled")&&!(!this.state.multiple&&s.classList.contains("-selected"))){if(this.state.multiple){e.stopPropagation();const i=this.options.find(l=>l.uxOption===s);i&&i.uxOption&&(i.attributes.selected=!i.attributes.selected,i.element.selected=i.attributes.selected,i.uxOption.classList.toggle("-selected"))}else for(const i of this.options){const l=i.uxOption===s;i.attributes.selected=l,i.element.selected=l,i.uxOption&&i.uxOption.classList.toggle("-selected",l)}return this.config.hideOnSelect&&this.uxEl.classList.remove("-shown"),this.update()}}onSearch(e){if(e.target===null)return;const i=e.target.value.toLowerCase(),l=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),t=this.uxEl.querySelectorAll(".ux-select-group");if(i===""){for(const o of this.options)o.uxOption&&(o.uxOption.style.display="");if(this.config.isGroupOptions)for(const o of t)o.style.display="";return}const n=new RegExp(l);for(const o of this.options){const r=n.test(o.data.text.toLowerCase());o.uxOption&&(o.uxOption.style.display=r?"":"none")}if(this.config.isGroupOptions)for(const o of t){o.style.display="";const r=o.querySelector(".ux-select-group__list");r&&(o.style.display=r.clientHeight!==0?"":"none")}u(this.el)}bindEvents(){this.uxEl.addEventListener("click",this.onToggleShown.bind(this)),this.uxClearButton&&this.uxClearButton.addEventListener("click",this.onClickClear.bind(this)),window.addEventListener("click",this.onClickOutside.bind(this)),this.config.isSearchable&&this.uxSearchInput&&this.uxSearchInput.addEventListener("input",this.onSearch.bind(this))}}return p}();
//# sourceMappingURL=ux-select.iife.js.map
